var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r["throw"](e))}catch(t){o(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(r){n=[6,r],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},BaseManager=function(){function e(){}return e}();__reflect(BaseManager.prototype,"BaseManager",["IManager"]);var BaseScene=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.CREATION_COMPLETE,t.onComplete,t),t}return __extends(t,e),t}(eui.Component);__reflect(BaseScene.prototype,"BaseScene");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,r){function i(e){t.call(r,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),n.call(r))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(r,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var c=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(r,generateJSON.paths[e])},this):RES.getResByUrl(c,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(r,generateJSON.paths[e])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var EntityConfig=function(){function e(){}return e.FISH=10,e.SHELL=11,e}();__reflect(EntityConfig.prototype,"EntityConfig");var GameStateConfig=function(){function e(){}return e.GAME_STATE_ACCOUNT_NULL=0,e.GAME_STATE_LOTTERY=100,e.GAME_STATE_LOTTERY_COMMON=200,e.GAME_STATE_LOTTERY_FREE=250,e.GAME_STATE_JP=300,e.TYPE_COMMON=0,e.TYPE_FREE=1,e}();__reflect(GameStateConfig.prototype,"GameStateConfig");var StateConfig=function(){function e(){}return e.IDEL=0,e.ACTIVITY=1,e}();__reflect(StateConfig.prototype,"StateConfig");var DeabedVo=function(){function e(){this.plant=new Array}return e.prototype.analysis=function(e){this.id=e.id,this.name=e.name,this.bg=e.bg;var t;for(t in e.plant){var n=new PlantVo;n.analysis(e.plant[t]),this.plant.push(n)}},e}();__reflect(DeabedVo.prototype,"DeabedVo");var PlantVo=function(){function e(){}return e.prototype.analysis=function(e){this.x=e.x,this.y=e.y,this.id=e.id},e}();__reflect(PlantVo.prototype,"PlantVo");var DiceInfo=function(){function e(){this.availableTimes=0,this.fishIndex=0}return e}();__reflect(DiceInfo.prototype,"DiceInfo");var DiceVo=function(){function e(){this.id=0,this.total=0,this["final"]=0,this.awardMap={},this.girdList=new Array}return e.prototype.analysis=function(e){this.total=e.total,this["final"]=e["final"];var t,n=0;for(t in e.awardMap)this.awardMap[n]=e.awardMap[n],n++;var r=e.Grid;for(t in r){var i=new GridVo;i.analysis(r[t]),this.girdList.push(i)}},e}();__reflect(DiceVo.prototype,"DiceVo");var FishCreateVo=function(){function e(){this.currentCount=0}return e.prototype.analysis=function(e){this.id=e.id,this.fishType=e.fishType,this.createTime=e.createTime,this.speed=e.speed,this.fishCount=e.fishCount,this.radius=e.radius,this.interval=e.interval,this.pathID=e.pathID},e}();__reflect(FishCreateVo.prototype,"FishCreateVo");var FishVo=function(){function e(){this.path=new Array}return e.prototype.analysis=function(e){this.name=e.name,this.rate=e.rate,this.id=e.id,this.hitTestLevel=e.hitTestLevel;var t,n=0;for(t in e.path){var r=new PathPointVo;r.analysis(e.path[t]),r.index=n,this.path.push(r),n++}},e}();__reflect(FishVo.prototype,"FishVo");var GridVo=function(){function e(){this.index=0,this.rewardType=0,this.rewardNum=0,this.offsetX=0,this.offsetY=0,this.x=0,this.y=0}return e.prototype.analysis=function(e){this.index=parseInt(e.index),this.rewardType=parseInt(e.rewardType),this.rewardNum=parseInt(e.rewardNum),this.offsetX=parseInt(e.offsetX),this.offsetY=parseInt(e.offsetY),this.x=parseInt(e.x),this.y=parseInt(e.y),this.isCover="0"==e.isCover?!1:!0},e}();__reflect(GridVo.prototype,"GridVo");var PathPointVo=function(){function e(){}return e.prototype.analysis=function(e){this.x=e[0],this.y=e[1],this.speed=e[2]},e}();__reflect(PathPointVo.prototype,"PathPointVo");var PlayerVo=function(){function e(){this.name="",this.moeny=0,this.cone=0,this.level=0,this.superWeapon=0,this.vipLevel=0,this.gunLevel=0,this.gunCount=0,this.totalExp=10,this.currentExp=0}return e}();__reflect(PlayerVo.prototype,"PlayerVo");var RoomInfoVo=function(){function e(){this.list=new Array}return e.prototype.analysis=function(e){var t=this;this.id=e.id,this.name=e.name,e.list.forEach(function(e){var n=new RoomInfoItemVo;n.analysis(e),t.list.push(n)})},e}();__reflect(RoomInfoVo.prototype,"RoomInfoVo");var RoomInfoItemVo=function(){function e(){}return e.prototype.analysis=function(e){this.index=e.index,this.name=e.name,this.state=e.state,this.desc=e.desc,this.min=e.min},e}();__reflect(RoomInfoItemVo.prototype,"RoomInfoItemVo");var ShellVo=function(){function e(){}return e.prototype.analysis=function(e){this.id=e.id,this.level=e.level,this.shell=e.shell,this.width=e.width,this.height=e.height,this.offx=e.offx,this.offy=e.offy,this.bomb=e.bomb,this.bombWidth=e.bombWidth,this.bombHeight=e.bombHeight,this.bombOffx=e.bombOffx,this.bombOffy=e.bombOffy,this.sendInterval=e.sendInterval,this.speed=e.speed},e}();__reflect(ShellVo.prototype,"ShellVo");var UserVo=function(){function e(){}return e}();__reflect(UserVo.prototype,"UserVo");var BaseStateMachine=function(){function e(e){this.owner=e,this.instanceMap={}}return e.prototype.addGlobalState=function(e){},e.prototype.changeState=function(e){this.currentClazz!=e&&(this.currentClazz=e,this.preState=this.cutState,this.preState&&this.preState.onExit(this.owner),this.instanceMap[e]||(this.instanceMap[e]=new e),this.cutState=this.instanceMap[e],this.cutState.onEnter(this.owner))},e.prototype.isInState=function(e){return this.currentClazz==e?!0:!1},e.prototype.update=function(e){},e}();__reflect(BaseStateMachine.prototype,"BaseStateMachine",["IStateMachine"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var AssetsManager=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,t){e()})]})})},t}(BaseManager);__reflect(AssetsManager.prototype,"AssetsManager");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?r(i):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var ClientManager=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._score=0,this._level=0,[2]})})},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),t.prototype.addScore=function(e){void 0===e&&(e=1),this._score+=e,this._level=Math.floor(this.score/2)},Object.defineProperty(t.prototype,"level",{get:function(){return this._level},enumerable:!0,configurable:!0}),t}(BaseManager);__reflect(ClientManager.prototype,"ClientManager");var ConfigManager=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,t){e()})]})})},t}(BaseManager);__reflect(ConfigManager.prototype,"ConfigManager");var HttpManager=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){e.proxy=new GameHttp,e.proxy.init(),t()})]})})},t}(BaseManager);__reflect(HttpManager.prototype,"HttpManager");var LocalManager=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,t){e()})]})})},t}(BaseManager);__reflect(LocalManager.prototype,"LocalManager");var PlatformManager=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,t){e()})]})})},t}(BaseManager);__reflect(PlatformManager.prototype,"PlatformManager");var SceneManager=function(){function e(){this.sceneMap={}}return Object.defineProperty(e,"instance",{get:function(){return null==e._manager&&(e._manager=new e),e._manager},enumerable:!0,configurable:!0}),e.prototype.changeScene=function(e){var t;this.sceneMap[e.toString()]||(t=new e,this.sceneMap[e.toString()]=t),this.currentScene&&(this.rootLayer.removeChild(this.currentScene),this.currentScene=null),this.rootLayer.addChild(t),this.currentScene=t},e.prototype.closeScene=function(e){this.removeScene(),this.pop_scene||(this.rootLayer.addChild(e),this.pop_scene=e)},e.prototype.removeScene=function(){this.pop_scene&&(this.rootLayer.removeChild(this.pop_scene),this.pop_scene=null)},e.prototype.init=function(e){this.rootLayer=e},e}();__reflect(SceneManager.prototype,"SceneManager",["IManager"]);var SocketManager=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){e.current=new GameSocket,e.current.init(),t()})]})})},t.prototype.connect=function(){this.current.connect("30.27.214.72",8899)},t}(BaseManager);__reflect(SocketManager.prototype,"SocketManager");var TimerManager=function(e){function t(){var t=e.call(this)||this;return t._shape=new egret.Shape,t._pool=new Array,t._handlers=new Object,t._currTimer=egret.getTimer(),t._currFrame=0,t._count=0,t._index=0,t._shape.addEventListener(egret.Event.ENTER_FRAME,t.onEnterFrame,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(e){},t.prototype.onEnterFrame=function(e){this._currFrame++,this._currTimer=egret.getTimer();var t;for(t in this._handlers)if("undefined"!=t){var n=this._handlers[t],r=n.userFrame?this._currFrame:this._currTimer;if(r>=n.exeTime){var i=n.method,o=n.args;if(n.repeat)for(;r>=n.exeTime&&t in this._handlers;)n.exeTime+=n.delay,i.apply(n.thisObj,o);else i.apply(n.thisObj,o),this.clearTimer(t)}}else console.log(t)},t.prototype.create=function(e,t,n,r,i,o,a){void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=!0);var s;if(a?(this.clearTimer(r),s=r):s=this._index++,1>n)return r.apply(null,o),-1;var c=this._pool.length>0?this._pool.pop():new TimerHandler;return c.userFrame=e,c.repeat=t,c.delay=n,c.method=r,c.thisObj=i,c.args=o,c.exeTime=n+(e?this._currFrame:this._currTimer),this._handlers[s]=c,this._count++,s},t.prototype.doOnce=function(e,t,n,r,i){return void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=!0),this.create(!1,!1,e,t,n,r,i)},t.prototype.doLoop=function(e,t,n,r,i){return void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=!0),this.create(!1,!0,e,t,n,r,i)},t.prototype.doFrameOnce=function(e,t,n,r,i){return void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=!0),this.create(!0,!1,e,t,n,r,i)},t.prototype.doFrameLoop=function(e,t,n,r,i){return void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=!0),this.create(!0,!0,e,t,n,r,i)},Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),t.prototype.clearTimer=function(e){var t=this._handlers[e];null!=t&&(delete this._handlers[e],t.clear(),this._pool.push(t),this._count--)},t.prototype.destroy=function(){this._shape.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},t.prototype.running=function(e){return null!=this._handlers[e]?!0:!1},t.prototype.clearTimerByFun=function(e){this.clearTimer(e)},t}(BaseManager);__reflect(TimerManager.prototype,"TimerManager");var TimerHandler=function(){function e(){this.delay=0,this.exeTime=0}return e.prototype.clear=function(){this.method=null,this.args=null,this.thisObj=null},e}();__reflect(TimerHandler.prototype,"TimerHandler");var UserManager=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(){},t}(BaseManager);__reflect(UserManager.prototype,"UserManager");var GameHttp=function(){function e(){}return e.prototype.init=function(){this.newXhr=!0,this.newXhr||(this.xhr=new XMLHttpRequest)},e.prototype.post=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){return[2,new Promise(function(n,r){t.newXhr&&(t.xhr=new XMLHttpRequest),t.xhr.open("post","https://www.aj.com:8080/get?msg_id=1&pic="+e),t.xhr.setRequestHeader("Access-Control-Allow-Origin","*"),t.xhr.addEventListener("error",t.onError.bind(t)),t.xhr.addEventListener("loadend",t.onComplete.bind(t)),t.xhr.addEventListener("readystatechange",function(e){4==t.xhr.readyState&&200==t.xhr.status&&(console.log("onStateChange.complete",e.currentTarget.response),n(e.currentTarget.response))}),t.xhr.send()})]})})},e.prototype.get=function(e){},e.prototype.onError=function(e){console.log("onError")},e.prototype.onComplete=function(e){console.log("onComplete")},e.prototype.onStateChange=function(e){4==this.xhr.readyState&&200==this.xhr.status&&console.log("onStateChange.complete",e.currentTarget.response)},e}();__reflect(GameHttp.prototype,"GameHttp",["IHttp"]);var GameSocket=function(){function e(){this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_STRING}return e.prototype.init=function(){},e.prototype.connect=function(e,t){this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.handler,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSuccess,this),this.socket.addEventListener(egret.Event.CLOSE,this.onClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),this.socket.connect(e,t)},e.prototype.onSuccess=function(e){},e.prototype.onError=function(e){},e.prototype.onClose=function(e){},e.prototype.send=function(e){this.socket.writeUTF(e),this.socket.flush()},e.prototype.handler=function(e){console.log("GameSocket.handler.data",e)},e}();__reflect(GameSocket.prototype,"GameSocket",["ISocket"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.initGame()["catch"](function(e){console.log(e)}).then(function(e){SceneManager.instance.changeScene(GameScene)})},t.prototype.initGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),console.time("game init"),[4,AssetsManager.instance.init()];case 2:return e.sent(),[4,ConfigManager.instance.init()];case 3:return e.sent(),[4,LocalManager.instance.init()];case 4:return e.sent(),[4,PlatformManager.instance.init()];case 5:return e.sent(),[4,HttpManager.instance.init()];case 6:return e.sent(),[4,ClientManager.instance.init()];case 7:return e.sent(),[4,TimerManager.instance.init()];case 8:return e.sent(),[4,UserManager.instance.init()];case 9:return e.sent(),[4,SceneManager.instance.init(this)];case 10:return e.sent(),console.timeEnd("game init"),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return n.sent(),this.stage.removeChild(e),[3,5];case 4:return t=n.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var r=new eui.Theme("resource/default.thm.json",e.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.VERSION="α1.0.0：160815-1514",t}(eui.UILayer);__reflect(Main.prototype,"Main");var GameScene=function(e){function t(){var t=e.call(this)||this;return t.corners=[],t.laplacian_threshold=30,t.min_eigen_value_threshold=25,t.skinName="GameSceneSkin",t.staticMachine=new BaseStateMachine(t),t}return __extends(t,e),t.prototype.onComplete=function(){this.staticMachine.changeState(GameStateInit)},t}(BaseScene);__reflect(GameScene.prototype,"GameScene",["IEntity"]);var GameStateInit=function(){function e(){this.constraints={video:{width:640,height:480,facingMode:"user"},audio:!1}}return e.prototype.onEnter=function(e){this.owner=e,this.owner.tipsLabel.text="来我和猜拳吧",this.owner.welcomeGroup.visible=!0,this.owner.collectionGroup.visible=!1,this.owner.animationGroup.visible=!1,this.owner.beginBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.owner.updateLabel.strokeColor=255,this.owner.updateLabel.stroke=1},e.prototype.onExit=function(e){this.owner.welcomeGroup.visible=!1,this.owner.video=document.getElementById("video"),navigator.mediaDevices.getUserMedia||navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia?this.getUserMedia({video:{width:640,height:480}},this.success,this.error):alert("你的浏览器不支持访问用户媒体设备"),this.owner.beginBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(e){this.owner.staticMachine.changeState(GameStateCollection)},e.prototype.getUserMedia=function(e,t,n){navigator.mediaDevices.getUserMedia?(navigator.mediaDevices.getUserMedia(this.constraints).then(this.success.bind(this))["catch"](this.error.bind(this)),console.log("mediaDevices.getUserMedia")):navigator.webkitGetUserMedia?(navigator.webkitGetUserMedia(this.constraints).then(this.success.bind(this))["catch"](this.error.bind(this)),console.log("webkitGetUserMedia")):navigator.mozGetUserMedia?(navigator.mozGetUserMedia(this.constraints).then(this.success.bind(this))["catch"](this.error.bind(this)),console.log("mozGetUserMedia")):navigator.getUserMedia&&(navigator.getUserMedia(this.constraints,this.success.bind(this),this.error.bind(this)),console.log("getUserMedia"))},e.prototype.success=function(e){window.URL||window.webkitURL;"srcObject"in this.owner.video?(this.owner.video.srcObject=e,console.log("srcObject")):(this.owner.video.src=window.URL&&window.URL.createObjectURL(e)||e,console.log("src")),this.owner.video.play()},e.prototype.error=function(e){console.error("访问用户媒体设备失败：",e.name,e.message),alert(e.name)},e.prototype.launchFullScreen=function(e){e.requestFullScreen?e.requestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen()},e}();__reflect(GameStateInit.prototype,"GameStateInit",["IState"]);var GameStateCollection=function(){function e(){}return e.prototype.onEnter=function(e){this.owner=e,this.cooldown=5,this.owner.tipsLabel.text="来我和猜拳吧",this.owner.tipsLabel.text="倒计时结束时一起猜拳",this.owner.cooldownLabel.text=this.cooldown.toString(),this.owner.collectionGroup.visible=!0,this.owner.collectionBtn.visible=!1,this.owner.collectionBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),TimerManager.instance.doLoop(1e3,this.update,this)},e.prototype.onExit=function(e){this.owner.collectionGroup.visible=!1,this.owner.collectionBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),TimerManager.instance.clearTimer(this.update)},e.prototype.onTap=function(e){void 0===e&&(e=null),this.owner.video.pause();var t=new egret.BitmapData(this.owner.video);t.width=this.owner.video.videoWidth,t.height=this.owner.video.videoHeight;var n=new egret.Texture;n.bitmapData=t,this.owner.pic=new egret.Bitmap(n),this.owner.pic.x=this.owner.stage.stageWidth-this.owner.pic.width>>1,this.owner.staticMachine.changeState(GameStateAnimation)},e.prototype.update=function(e){this.cooldown-=1,this.owner.cooldownLabel.text=this.cooldown.toString(),this.cooldown<0&&this.onTap()},e.prototype.render_corners=function(e,t,n,r){for(var i=-16711936,o=0;t>o;++o){var a=e[o].x,s=e[o].y,c=a+s*r;n[c]=i,n[c-1]=i,n[c+1]=i,n[c-r]=i,n[c+r]=i}},e}();__reflect(GameStateCollection.prototype,"GameStateCollection",["IState"]);var GameStateAnimation=function(){function e(){this.index=5}return e.prototype.onEnter=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){return this.owner=e,this.owner.tipsLabel.text="我出",this.owner.updateLabel.text="识别中",this.owner.animationGroup.visible=!0,this.owner.replayBtn.visible=!1,TimerManager.instance.doLoop(500,this.updateTime,this),this.owner.replayBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeState,this),HttpManager.instance.proxy.post(this.owner.pic.texture.toDataURL("image/png")).then(function(e){console.log(e);var n=JSON.parse(e),r="";switch(n.type.toString()){case"0":r="石头";break;case"1":r="剪刀";break;case"2":r="布"}TimerManager.instance.clearTimer(t.updateTime);var i=Math.random(),o="",a="";.3>i?(o="石头",a="平局"):.7>i?(o="剪刀",a="平局"):(o="布",a="平局"),t.owner.tipsLabel.text="我出是："+o,t.owner.updateLabel.text="您出的是："+r+"\n您"+a+"了",TimerManager.instance.doOnce(2e3,function(){t.owner.video.play(),t.owner.replayBtn.visible=!0})}),[2]})})},e.prototype.onExit=function(e){this.owner.animationGroup.visible=!1,this.owner.replayBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.changeState,this)},e.prototype.updateTime=function(){this.owner.updateLabel.text+="。",this.index=5},e.prototype.changeState=function(){this.owner.staticMachine.changeState(GameStateCollection)},e}();__reflect(GameStateAnimation.prototype,"GameStateAnimation",["IState"]);var LoadingScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="",t}return __extends(t,e),t.prototype.onComplete=function(){},t}(BaseScene);__reflect(LoadingScene.prototype,"LoadingScene");var LoginScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="",t}return __extends(t,e),t.prototype.onComplete=function(){},t}(BaseScene);__reflect(LoginScene.prototype,"LoginScene");